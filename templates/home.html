<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Downloader</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>

    <header>
        <h1>üéµ Welcome to Echo Music</h1>
    </header>

    <main>
        <form action="" method="post" class="search-form">
            <input type="search" name="song-search" id="searchbar" placeholder="Search for a song..." />
            <input type="submit" value="Search" />
        </form>

        <div class="songs-container">
            {% for song in songs %}
            <div class="song-card">

                <div class="image-download-area">
                    <img src="{{ song['image'][1]['url'] }}" alt="Song Art" class="album-art">
                </div>

                <div class="song-details">
                    <h2>{{ song['name'] }}</h2>
                    <p>{{ song['artists']['primary'][0]['name'] }}</p>
                    <p class="duration" data-seconds="{{ song['duration'] }}"></p>

                    <div class="audio-center">
                        <audio src="{{ song['downloadUrl'][-1]['url'] }}" controls></audio>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </main>

<!-- üéß Bottom Now Playing Bar -->
<div id="nowPlayingBar" class="hidden">
    <img id="npImage" src="" alt="Album Art">
    <div class="np-info">
        <h3 id="npName">Song Name</h3>
        <p id="npArtist">Artist Name</p>
        <input type="range" id="npProgress" value="0" min="0" max="100">
    </div>
    <div class="np-controls">
        <button id="prevBtn">‚èÆ</button>
        <button id="playPauseBtn">‚è∏</button>
        <button id="nextBtn">‚è≠</button>
    </div>
</div>

<script>
    // Format duration
    function formatDuration(seconds) {
        const min = Math.floor(seconds / 60);
        const sec = Math.floor(seconds % 60);
        return `${min}:${sec.toString().padStart(2, '0')}`;
    }
    document.querySelectorAll('.duration').forEach(el => {
        const seconds = parseInt(el.dataset.seconds, 10);
        el.textContent = formatDuration(seconds);
    });

    const audios = document.querySelectorAll("audio");
    const images = document.querySelectorAll(".album-art");

    const bar = document.getElementById("nowPlayingBar");
    const npImage = document.getElementById("npImage");
    const npName = document.getElementById("npName");
    const npArtist = document.getElementById("npArtist");
    const playPauseBtn = document.getElementById("playPauseBtn");
    const nextBtn = document.getElementById("nextBtn");
    const prevBtn = document.getElementById("prevBtn");
    const npProgress = document.getElementById("npProgress");

    let currentIndex = -1;
    let progressInterval;

    audios.forEach((audio, i) => {
        audio.addEventListener("play", () => {
            audios.forEach((a, j) => {
                if (i !== j) {
                    a.pause();
                    images[j].classList.remove("spinning");
                }
            });
            images[i].classList.add("spinning");
            currentIndex = i;

            const card = audio.closest(".song-card");
            const name = card.querySelector("h2").textContent;
            const artist = card.querySelector("p").textContent;
            const imgSrc = card.querySelector("img").src;

            npName.textContent = name;
            npArtist.textContent = artist;
            npImage.src = imgSrc;
            bar.classList.remove("hidden");
            playPauseBtn.textContent = "‚è∏";

            clearInterval(progressInterval);
            progressInterval = setInterval(() => {
                if (!audio.paused) {
                    npProgress.value = (audio.currentTime / audio.duration) * 100 || 0;
                }
            }, 500);
        });

        audio.addEventListener("pause", () => {
            images[i].classList.remove("spinning");
        });

        audio.addEventListener("ended", () => {
            clearInterval(progressInterval);
            const next = audios[i + 1];
            if (next) next.play();
        });
    });

    npProgress.addEventListener("input", () => {
        const current = audios[currentIndex];
        if (current) {
            current.currentTime = (npProgress.value / 100) * current.duration;
        }
    });

    playPauseBtn.addEventListener("click", () => {
        const current = audios[currentIndex];
        if (!current) return;
        if (current.paused) {
            current.play();
            playPauseBtn.textContent = "‚è∏";
        } else {
            current.pause();
            playPauseBtn.textContent = "‚ñ∂Ô∏è";
        }
    });

    nextBtn.addEventListener("click", () => {
        if (currentIndex < audios.length - 1) {
            audios[currentIndex].pause();
            audios[currentIndex + 1].play();
        }
    });

    prevBtn.addEventListener("click", () => {
        if (currentIndex > 0) {
            audios[currentIndex].pause();
            audios[currentIndex - 1].play();
        }
    });
    </script>
</body>
</html>         
<style>
    body {
        margin: 0;
        font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
        background: linear-gradient(135deg, #1e1e2f 0%, #2a2a4a 100%);
        color: #fff;
        min-height: 100vh;
    }
    header {
        background: rgba(34, 34, 51, 0.95);
        padding: 2rem 0 1rem 0;
        text-align: center;
        box-shadow: 0 2px 12px 0 rgba(0,0,0,0.12);
    }
    header h1 {
        font-weight: 700;
        font-size: 2.2rem;
        letter-spacing: 1px;
        color: #fff;
        margin: 0;
    }
    .search-form {
        display: flex;
        justify-content: center;
        margin: 2rem 0 1.5rem 0;
    }
    .search-form input[type="search"] {
        width: 320px;
        padding: 0.7rem 1rem;
        border: none;
        border-radius: 24px 0 0 24px;
        background: #23233a;
        color: #fff;
        font-size: 1rem;
        outline: none;
        transition: background 0.2s;
    }
    .search-form input[type="search"]:focus {
        background: #29294a;
    }
    .search-form input[type="submit"] {
        padding: 0.7rem 1.5rem;
        border: none;
        border-radius: 0 24px 24px 0;
        background: #ff2e63;
        color: #fff;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.2s;
    }
    .search-form input[type="submit"]:hover {
        background: #e02356;
    }
    .songs-container {
        display: flex;
        flex-wrap: wrap;
        gap: 2rem;
        justify-content: center;
        padding-bottom: 120px;
    }
    .song-card {
        background: rgba(34, 34, 51, 0.95);
        border-radius: 24px;
        box-shadow: 0 4px 24px 0 rgba(0,0,0,0.18);
        width: 320px;
        display: flex;
        flex-direction: row;
        align-items: center;
        padding: 1.2rem 1.2rem 1.2rem 1.2rem;
        margin-bottom: 1rem;
        transition: transform 0.15s;
        position: relative;
    }
    .song-card:hover {
        transform: translateY(-6px) scale(1.025);
        box-shadow: 0 8px 32px 0 rgba(255,46,99,0.18);
    }
    .image-download-area {
        flex-shrink: 0;
        margin-right: 1.2rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .album-art {
        width: 72px;
        height: 72px;
        border-radius: 16px;
        object-fit: cover;
        box-shadow: 0 2px 12px 0 rgba(255,46,99,0.12);
        transition: box-shadow 0.2s;
    }
    .album-art.spinning {
        animation: spin 2.5s linear infinite;
    }
    @keyframes spin {
        100% { transform: rotate(360deg);}
    }
    .song-details {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 0.2rem;
    }
    .song-details h2 {
        font-size: 1.1rem;
        font-weight: 600;
        margin: 0 0 0.2rem 0;
        color: #fff;
        letter-spacing: 0.5px;
    }
    .song-details p {
        margin: 0;
        color: #bdbdd7;
        font-size: 0.98rem;
    }
    .song-details .duration {
        font-size: 0.93rem;
        color: #ff2e63;
        font-weight: 500;
        margin-bottom: 0.2rem;
    }
    .audio-center {
        margin-top: 0.5rem;
    }
    audio {
        width: 100%;
        accent-color: #ff2e63;
        background: transparent;
    }
    /* Now Playing Bar */
    #nowPlayingBar {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, #23233a 0%, #ff2e63 100%);
        color: #fff;
        display: flex;
        align-items: center;
        padding: 1rem 2rem;
        box-shadow: 0 -2px 24px 0 rgba(255,46,99,0.12);
        z-index: 100;
        transition: transform 0.3s;
        min-height: 80px;
        gap: 1.5rem;
    }
    #nowPlayingBar.hidden {
        transform: translateY(120%);
        pointer-events: none;
    }
    #npImage {
        width: 56px;
        height: 56px;
        border-radius: 12px;
        object-fit: cover;
        box-shadow: 0 2px 12px 0 rgba(255,46,99,0.18);
        margin-right: 1rem;
    }
    .np-info {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 0.2rem;
    }
    #npName {
        font-size: 1.1rem;
        font-weight: 600;
        margin: 0;
        color: #fff;
    }
    #npArtist {
        font-size: 0.97rem;
        color: #f7c5d8;
        margin: 0;
    }
    #npProgress {
        width: 100%;
        margin-top: 0.3rem;
        accent-color: #fff;
        background: #ff2e63;
        height: 4px;
        border-radius: 2px;
    }
    .np-controls {
        display: flex;
        align-items: center;
        gap: 1.2rem;
    }
    .np-controls button {
        background: none;
        border: none;
        color: #fff;
        font-size: 1.7rem;
        cursor: pointer;
        transition: color 0.2s;
        border-radius: 50%;
        padding: 0.3rem 0.7rem;
    }
    .np-controls button:hover {
        background: rgba(255,46,99,0.12);
        color: #ff2e63;
    }
    @media (max-width: 600px) {
        .songs-container {
            flex-direction: column;
            gap: 1.2rem;
        }
        .song-card {
            width: 95vw;
            min-width: 0;
        }
        #nowPlayingBar {
            flex-direction: column;
            align-items: flex-start;
            padding: 1rem;
            gap: 0.7rem;
        }
        .np-controls {
            gap: 0.7rem;
        }
    }
</style>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
